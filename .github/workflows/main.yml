name: Game CI Template
run-name: ${{ github.actor }} is using Game CI ðŸš€
on: [push]

jobs:
    build:
      name: Build the project
      runs-on: ubuntu-latest
      steps:
        - name: Check code
          uses: actions/checkout@v4
          with:
            lfs: true

        - name: Cache code
          uses: actions/cache@v3
          with:
            path: Library
            key: Library-${{ hashFiles('Assets/**', 'Packages/**', 'ProjectSettings/**')}}
            restore-keys: |
              Library-
        
        - name: Run Tests
          uses: game-ci/unity-test-runner@v4
          env:
            UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
            UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
            UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
          with:
            projectPath: Moving On/
            githubToken: ${{ secrets.GITHUB_TOKEN }}

        - name: Build project
          uses: game-ci/unity-builder@v4
          env:
            UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
            UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
            UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
          with:
            projectPath: Moving On
            targetPlatform: WebGL
            allowDirtyBuild: true
        
        - name: Deploy built project
          uses: actions/upload-artifact@v3
          with:
            projectPath: Moving On/
            name: Build
            path: DeployedBuilds/
            allowDirtyBuild: true